
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Testing &#8212; inflation 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="quantuminflation package" href="quantuminflation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[207]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1"># Locate the script in UnifiedInflation/examples and add to path one folder before, that is, UnifiedInflation/</span>
<span class="c1"># in order to be able to import quantuminflation</span>
<span class="c1"># ! Note: I found online that &quot;__file__&quot; sometimes can be problematic, So I&#39;m using the solution provided in</span>
<span class="c1"># https://stackoverflow.com/questions/2632199/how-do-i-get-the-path-of-the-current-executed-file-in-python?lq=1</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getsourcefile</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">abspath</span>
<span class="kn">from</span> <span class="nn">tabnanny</span> <span class="kn">import</span> <span class="n">verbose</span>

<span class="c1">#cws = abspath(getsourcefile(lambda:0))</span>
<span class="n">cws</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">cws</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cws</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Remove the script filename to get the directory of the script</span>
<span class="n">cws</span> <span class="o">=</span> <span class="n">cws</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span>  <span class="c1"># Go one folder above UnifiedInflation/examples -&gt; UnifiedInflation/</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cws</span><span class="p">)</span>
<span class="c1">###############################################################################</span>

<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">quantuminflation.InflationProblem</span> <span class="kn">import</span> <span class="n">InflationProblem</span>
<span class="kn">from</span> <span class="nn">quantuminflation.InflationSDP</span> <span class="kn">import</span> <span class="n">InflationSDP</span>
<span class="kn">from</span> <span class="nn">quantuminflation.useful_distributions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">quantuminflation.general_tools</span> <span class="kn">import</span> <span class="n">to_numbers</span>

<span class="kn">from</span> <span class="nn">quantuminflation.fast_npa</span> <span class="kn">import</span> <span class="n">calculate_momentmatrix</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">from</span> <span class="nn">ncpol2sdpa.nc_utils</span> <span class="kn">import</span> <span class="n">apply_substitutions</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
</pre></div>
</div>
</div>
<p>Calculate the objective function. First we encode <span class="math notranslate nohighlight">\(U_{0|0}\)</span>, <span class="math notranslate nohighlight">\(U_{0|1}\)</span> and <span class="math notranslate nohighlight">\(V\)</span>. From the paper:</p>
<p><span class="math notranslate nohighlight">\(\begin{aligned} U_{0 \mid 0}(p)=&amp; 1-p_{A}(0 \mid 1)-p_{B}(0 \mid 1)+2 p(00 \mid 11) \\ U_{0 \mid 1}(p)=&amp; 1-0.0329 p_{B}(0 \mid 0)-0.7117 p_{B}(0 \mid 2) \\ &amp;-0.0329 p_{A}(0 \mid 0)-0.8418 p(0,0 \mid 0,0) \\ &amp;+0.6359 p(0,0 \mid 0,2)-0.7117 p_{A}(0 \mid 2) \\ &amp;+0.6359 p(0,0 \mid 2,0)+0.4360 p(0,0 \mid 2,2) \end{aligned}\)</span></p>
<p><span class="math notranslate nohighlight">\(\begin{aligned} V(p)=&amp; 0.1590+0.8372 p_{B}(0 \mid 0)+0.0031 p_{B}(0 \mid 1) \\ &amp;-0.1544 p_{A}(0 \mid 0)-0.6132 p(0,0 \mid 0,0) \\ &amp;+0.5547 p(0,0 \mid 0,1)+0.5884 p_{A}(0 \mid 1) \\ &amp;-0.5902 p(0,0 \mid 1,0)-0.7404 p(0,0 \mid 11) \end{aligned}\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[208]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The U first</span>

<span class="c1">### The first input</span>
<span class="n">outs_cardinality_ef</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">ins_cardinality_ef</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">number_alpha</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">number_eta</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_alpha</span><span class="p">,</span> <span class="n">number_eta</span><span class="p">,</span> <span class="o">*</span><span class="n">outs_cardinality_ef</span><span class="p">,</span> <span class="o">*</span><span class="n">ins_cardinality_ef</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">longdouble</span><span class="p">)</span>

<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>

<span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:,:,:]</span> <span class="o">-=</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:,:,:]</span>

<span class="n">U_01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">outs_cardinality_ef</span><span class="p">,</span><span class="o">*</span><span class="n">ins_cardinality_ef</span><span class="p">))</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.0329</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.7117</span>

<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.0329</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.7117</span>

<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.8418</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.6359</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.6359</span>
<span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.4360</span>

<span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:,:,:]</span> <span class="o">-=</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:,:,:]</span>

<span class="c1"># The V</span>
<span class="n">outs_cardinality_ug</span> <span class="o">=</span> <span class="p">[</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">ins_cardinality_ug</span>  <span class="o">=</span> <span class="p">[</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>

<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">outs_cardinality_ug</span><span class="p">,</span><span class="o">*</span><span class="n">ins_cardinality_ug</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">longdouble</span><span class="p">)</span>  <span class="c1"># V[alpha,c,eta,z]</span>
<span class="n">V</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.1590</span>

<span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.1544</span>
<span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.5884</span>

<span class="n">V</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.8372</span>
<span class="n">V</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.0031</span>
<span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.6132</span>
<span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">+</span><span class="mf">0.5547</span>
<span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.5902</span>
<span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.7404</span>
</pre></div>
</div>
</div>
<p>Do the index contraction for the W</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[209]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#W = np.einsum(&#39;AcEz,AEabxy-&gt;abcxyz&#39;, V2[:-1,:,:,:], U)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;AcEz,AEabxy-&gt;abcxyz&#39;</span><span class="p">,</span> <span class="n">V</span><span class="p">[:,:,:,:],</span> <span class="n">U</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Define an auxiliary scenario. We need to run a trivial problem to compile the functions. This will be improved later.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[210]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span> <span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span><span class="n">outcomes_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span><span class="n">settings_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Currently needed to run a trivial problem to precompile the functions, this can be changed later&#39;</span><span class="p">)</span>
<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">_build_columns</span><span class="p">([[],[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">cols_small</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">generating_monomials</span><span class="p">]</span>
<span class="n">momentmatrix</span><span class="p">,</span> <span class="n">vardic</span> <span class="o">=</span> <span class="n">calculate_momentmatrix</span><span class="p">(</span><span class="n">cols_small</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Currently needed to run a trivial problem to precompile the functions, this can be changed later
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 2/2 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<section id="Testing">
<h1>Testing<a class="headerlink" href="#Testing" title="Permalink to this headline">¶</a></h1>
<p>Check if <span class="math notranslate nohighlight">\(U_{0|0}\)</span>, <span class="math notranslate nohighlight">\(U_{0|1}\)</span> and <span class="math notranslate nohighlight">\(V\)</span> are valid NBF over AQ. We’ll try to find the maximum and minimum over AQ.</p>
<p>First <span class="math notranslate nohighlight">\(U_{0|0}\)</span>, <span class="math notranslate nohighlight">\(U_{0|1}\)</span></p>
<p>!! After checking the first time, we renormalize to machine precision.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[211]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span> <span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                            <span class="n">outcomes_per_party</span><span class="o">=</span><span class="n">outs_cardinality_ef</span><span class="p">,</span>
                            <span class="n">settings_per_party</span><span class="o">=</span><span class="n">ins_cardinality_ef</span><span class="p">,</span>
                            <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">filename_label</span> <span class="o">=</span> <span class="s1">&#39;AQ_U&#39;</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span>
                            <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">filename_label</span><span class="o">=</span><span class="n">filename_label</span><span class="p">)</span>
<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>
<span class="k">for</span> <span class="n">eta</span><span class="p">,</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]):</span>
        <span class="n">Pi_A</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Pi_B</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">obj</span> <span class="o">+=</span> <span class="n">U</span><span class="p">[</span><span class="n">alpha</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span><span class="o">*</span><span class="n">Pi_A</span><span class="o">*</span><span class="n">Pi_B</span>
    <span class="c1"># if (alpha, eta) == (0, 1):</span>
    <span class="c1">#     obj -= 0.8</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;U_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; =&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
    <span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=-</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>  <span class="c1"># By default it maximizes</span>
    <span class="n">minimo</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum over AQ of U_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">eta</span><span class="p">),</span> <span class="o">-</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
    <span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>  <span class="c1"># By default it maximizes</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximum over AQ of U_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">eta</span><span class="p">),</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
    <span class="n">maximo</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span>
    <span class="c1"># Add the minimum and divide by the difference between the maximum and minimum</span>
    <span class="c1"># U[alpha,eta,:,:,0,0] += minimo</span>
    <span class="c1"># U[alpha,eta,:,:,:,:] /= maximo - minimo</span>

<span class="c1"># obj = (1 +</span>
<span class="c1">#         -0.0329*meas[1][0][0][0] +</span>
<span class="c1">#         -0.7117*meas[1][0][2][0] +</span>
<span class="c1">#         -0.0329*meas[0][0][0][0] +</span>
<span class="c1">#         -0.7117*meas[0][0][2][0] +</span>
<span class="c1">#         -0.8418*meas[0][0][0][0]*meas[1][0][0][0] +</span>
<span class="c1">#         +0.6359*meas[0][0][0][0]*meas[1][0][2][0] +</span>
<span class="c1">#         +0.6359*meas[0][0][2][0]*meas[1][0][0][0] +</span>
<span class="c1">#         +0.4360*meas[0][0][2][0]*meas[1][0][2][0] )</span>
<span class="c1"># obj = sp.expand(obj)</span>
<span class="c1"># InfSDP.set_objective(objective=-obj)</span>
<span class="c1"># print(obj)</span>
<span class="c1"># InfSDP.solve()  # By default it maximizes</span>
<span class="c1"># print(&quot;Minimum over AQ of V&quot;, InfSDP.primal_objective)</span>
<span class="c1"># InfSDP.set_objective(objective=obj)</span>
<span class="c1"># InfSDP.solve()  # By default it maximizes</span>
<span class="c1"># print(&quot;Maximum over AQ of V&quot;, InfSDP.primal_objective)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 16/16 [00:00&lt;00:00, 1777.86it/s]
Writing momentmatrix to file : 100%|██████████| 16/16 [00:00&lt;00:00, 5329.48it/s]
Writing monomials to file    : 100%|██████████| 57/57 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 57/57 [00:00&lt;00:00, 11398.65it/s]
Reassigning monomial variables: 100%|██████████| 57/57 [00:00&lt;?, ?it/s]
Reassigning moment matrix indices: 100%|██████████| 16/16 [00:00&lt;00:00, 16012.61it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
U_00 = 1.0 - 1.0*A_1_1_0 + 2.0*A_1_1_0*B_1_1_0 - 1.0*B_1_1_0
minimum over AQ of U_00 -1.4420064919917763e-08
Maximum over AQ of U_00 1.0000000128535476
U_10 = 1.0*A_1_1_0 - 2.0*A_1_1_0*B_1_1_0 + 1.0*B_1_1_0
minimum over AQ of U_10 -1.2853547667126446e-08
Maximum over AQ of U_10 1.000000014420065
U_01 = 1.0 - 0.0329*A_1_0_0 - 0.8418*A_1_0_0*B_1_0_0 + 0.6359*A_1_0_0*B_1_2_0 - 0.7117*A_1_2_0 + 0.6359*A_1_2_0*B_1_0_0 + 0.436*A_1_2_0*B_1_2_0 - 0.0329*B_1_0_0 - 0.7117*B_1_2_0
minimum over AQ of U_01 1.5576856671417616e-05
Maximum over AQ of U_01 1.0000207289194862
U_11 = 0.0329*A_1_0_0 + 0.8418*A_1_0_0*B_1_0_0 - 0.6359*A_1_0_0*B_1_2_0 + 0.7117*A_1_2_0 - 0.6359*A_1_2_0*B_1_0_0 - 0.436*A_1_2_0*B_1_2_0 + 0.0329*B_1_0_0 + 0.7117*B_1_2_0
minimum over AQ of U_11 -2.0728919393495328e-05
Maximum over AQ of U_11 0.9999844231346401
</pre></div></div>
</div>
<p>Now lets check <span class="math notranslate nohighlight">\(V\)</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[212]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span> <span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                            <span class="n">outcomes_per_party</span><span class="o">=</span><span class="n">outs_cardinality_ug</span><span class="p">,</span>
                            <span class="n">settings_per_party</span><span class="o">=</span><span class="n">ins_cardinality_ug</span><span class="p">,</span>
                            <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">filename_label</span> <span class="o">=</span> <span class="s1">&#39;AQ_V&#39;</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span>
                            <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">filename_label</span><span class="o">=</span><span class="n">filename_label</span><span class="p">)</span>
<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>

<span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">]):</span>
    <span class="n">Pi_A</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="o">-</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Pi_B</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="o">-</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">+=</span> <span class="n">V</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span><span class="o">*</span><span class="n">Pi_A</span><span class="o">*</span><span class="n">Pi_B</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=-</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>  <span class="c1"># By default it maximizes</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum over AQ of V_&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
<span class="n">minimo</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>  <span class="c1"># By default it maximizes</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximum over AQ of V_&quot;</span><span class="p">,</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
<span class="n">maximo</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span>
<span class="c1"># V[:,:,0,0] += minimo</span>
<span class="c1"># V[:,:,:,:] /= maximo - minimo</span>


<span class="n">obj1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1590</span> <span class="o">+</span>
        <span class="o">+</span><span class="mf">0.8372</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="o">+</span><span class="mf">0.0031</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="o">-</span><span class="mf">0.1544</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="o">+</span><span class="mf">0.5884</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="o">-</span><span class="mf">0.6132</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="o">+</span><span class="mf">0.5547</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="o">-</span><span class="mf">0.5902</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="o">-</span><span class="mf">0.7404</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj1</span><span class="o">-</span><span class="n">obj</span><span class="p">)</span>
<span class="c1"># print(obj)</span>
<span class="c1"># InfSDP.set_objective(objective=-obj)</span>
<span class="c1"># InfSDP.solve()  # By default it maximizes</span>
<span class="c1"># print(&quot;minimum over AQ of V&quot;, InfSDP.primal_objective)</span>
<span class="c1"># InfSDP.set_objective(objective=obj)</span>
<span class="c1"># InfSDP.solve()  # By default it maximizes</span>
<span class="c1"># print(&quot;Maximum over AQ of V&quot;, InfSDP.primal_objective)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 9/9 [00:00&lt;00:00, 3001.65it/s]
Writing momentmatrix to file : 100%|██████████| 9/9 [00:00&lt;00:00, 8998.51it/s]
Writing monomials to file    : 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 16/16 [00:00&lt;00:00, 8002.49it/s]
Reassigning monomial variables: 100%|██████████| 16/16 [00:00&lt;00:00, 16004.98it/s]
Reassigning moment matrix indices: 100%|██████████| 9/9 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.159 - 0.1544*A_1_0_0 - 0.6132*A_1_0_0*B_1_0_0 + 0.5547*A_1_0_0*B_1_1_0 + 0.5884*A_1_1_0 - 0.5902*A_1_1_0*B_1_0_0 - 0.7404*A_1_1_0*B_1_1_0 + 0.8372*B_1_0_0 + 0.0031*B_1_1_0
minimum over AQ of V_ -2.5077128465444964e-06
Maximum over AQ of V_ 0.9999673614230343
0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<section id="Check-CHSH-with-the-SDP">
<h2>Check CHSH with the SDP<a class="headerlink" href="#Check-CHSH-with-the-SDP" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[213]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span><span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">outcomes_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">settings_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span>
                            <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">filename_label</span><span class="o">=</span><span class="n">filename_label</span><span class="p">)</span>
<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>
<span class="n">A0</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">B1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">obj</span> <span class="o">=</span>  <span class="n">A0</span><span class="o">*</span><span class="n">B0</span><span class="o">+</span><span class="n">A0</span><span class="o">*</span><span class="n">B1</span><span class="o">+</span><span class="n">A1</span><span class="o">*</span><span class="n">B0</span><span class="o">-</span><span class="n">A1</span><span class="o">*</span><span class="n">B1</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=+</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;CVXPY&#39;</span><span class="p">)</span>  <span class="c1"># By default it maximizes</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum over AQ of CHSH&quot;</span><span class="p">,</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 9/9 [00:00&lt;00:00, 4503.01it/s]
Writing momentmatrix to file : 100%|██████████| 9/9 [00:00&lt;00:00, 9002.80it/s]
Writing monomials to file    : 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 16/16 [00:00&lt;00:00, 7999.63it/s]
Reassigning monomial variables: 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Reassigning moment matrix indices: 100%|██████████| 9/9 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2 - 4*A_1_0_0 + 4*A_1_0_0*B_1_0_0 + 4*A_1_0_0*B_1_1_0 + 4*A_1_1_0*B_1_0_0 - 4*A_1_1_0*B_1_1_0 - 4*B_1_0_0
minimum over AQ of CHSH 2.8284271790023405
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>Do the index contraction for the W</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[214]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#W = np.einsum(&#39;AcEz,AEabxy-&gt;abcxyz&#39;, V2[:-1,:,:,:], U)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;AcEz,AEabxy-&gt;abcxyz&#39;</span><span class="p">,</span> <span class="n">V</span><span class="p">[:,:,:,:],</span> <span class="n">U</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Define an auxiliary scenario. We need to run a trivial problem to compile the functions. This will be improved later.</p>
</section>
</section>
<section id="Functions-for-Collins-Gisin-notation">
<h1>Functions for Collins Gisin notation<a class="headerlink" href="#Functions-for-Collins-Gisin-notation" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[215]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quantuminflation.general_tools</span> <span class="kn">import</span> <span class="n">find_permutation</span><span class="p">,</span> <span class="n">apply_substitutions</span>
<span class="kn">from</span> <span class="nn">ncpol2sdpa.nc_utils</span> <span class="kn">import</span> <span class="n">flatten</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[216]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prob_to_CG_2parties</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">):</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">settings_per_party</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">p_CG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="n">a_</span><span class="p">,:,</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[:,</span><span class="n">b_</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="n">a_</span><span class="p">,</span><span class="n">b_</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p_CG</span>

<span class="k">def</span> <span class="nf">prob_to_CG_3parties</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">):</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">settings_per_party</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">p_CG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="n">a_</span><span class="p">,:,:,</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[:,</span><span class="n">b_</span><span class="p">,:,</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">c_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[:,:,</span><span class="n">c_</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="n">a_</span><span class="p">,</span><span class="n">b_</span><span class="p">,:,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">c_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="n">a_</span><span class="p">,:,</span><span class="n">c_</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">c_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">[:,</span><span class="n">b_</span><span class="p">,</span><span class="n">c_</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">c_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">p_CG</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="n">a_</span><span class="p">,</span><span class="n">b_</span><span class="p">,</span><span class="n">c_</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p_CG</span>

<span class="c1"># outcomes_per_party = [2, 2, 2]</span>
<span class="c1"># settings_per_party = [2, 2, 2]</span>
<span class="c1"># prob = np.ones([2,2,2,2,2,2])/8</span>
<span class="c1"># prob_to_CG_2parties(prob, outcomes_per_party, settings_per_party)</span>

<span class="c1"># outcomes_per_party = [2, 2]</span>
<span class="c1"># settings_per_party = [2, 2]</span>
<span class="c1"># prob = np.ones([2,2,2,2])/4</span>
<span class="c1"># prob_to_CG_2parties(prob, outcomes_per_party, settings_per_party)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[311]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">CG_to_prob_2party</span><span class="p">(</span><span class="n">p_CG</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">):</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">,</span> <span class="o">*</span><span class="n">settings_per_party</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">,</span> <span class="o">*</span><span class="n">settings_per_party</span><span class="p">)]):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># An alternative to ravel_multi_index is to just output outcomes_per_party[0]*a+x and outcomes_per_party[1]*b+y, which is faster,</span>
            <span class="c1"># but in my mind this code is more flexible. If performance is an issue when converting</span>
            <span class="c1"># from Collins Gisin to normal probability, the straight multiplication should be used as it is is 1000x faster.</span>
            <span class="c1"># But I don&#39;t forsee this being a bottleneck.</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">b</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">b</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">a_</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">suma</span> <span class="o">+=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">]</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">b_</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">suma</span> <span class="o">+=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">]</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">suma_A</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">a_</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">suma_A</span> <span class="o">+=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">suma_B</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">b_</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">suma_B</span> <span class="o">+=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">]</span>

            <span class="n">suma_AB</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">a_</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">([</span><span class="n">b_</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="n">suma_AB</span> <span class="o">+=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">]</span>

            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">suma_A</span> <span class="o">-</span> <span class="n">suma_B</span> <span class="o">+</span> <span class="n">suma_AB</span>
    <span class="c1">#assert np.allclose(prob.sum(axis=(0,1)), 1)</span>
    <span class="k">return</span> <span class="n">prob</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[312]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">CG_to_prob_3party</span><span class="p">(</span><span class="n">p_CG</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">):</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">,</span> <span class="o">*</span><span class="n">settings_per_party</span><span class="p">))</span>
    <span class="n">a_last</span><span class="p">,</span> <span class="n">b_last</span><span class="p">,</span> <span class="n">c_last</span> <span class="o">=</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">,</span> <span class="o">*</span><span class="n">settings_per_party</span><span class="p">)]):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span> <span class="c1">#np.ravel_multi_index([a,x],[outcomes_per_party[0],settings_per_party[0]])</span>
        <span class="n">by</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span> <span class="c1">#np.ravel_multi_index([b,y],[outcomes_per_party[1],settings_per_party[1]])</span>
        <span class="n">cz</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span> <span class="c1">#np.ravel_multi_index([c,z],[outcomes_per_party[2],settings_per_party[2]])</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)])</span>  <span class="c1"># Sum over all a_ except the last</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)])</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">suma_A</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)])</span>
            <span class="n">suma_B</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)])</span>
            <span class="n">suma_AB</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)])</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">cz</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma_A</span> <span class="o">-</span> <span class="n">suma_B</span> <span class="o">+</span> <span class="n">suma_AB</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">suma_A</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)])</span>
            <span class="n">suma_C</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">suma_AC</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">by</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma_A</span> <span class="o">-</span> <span class="n">suma_C</span> <span class="o">+</span> <span class="n">suma_AC</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">suma_B</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)])</span>
            <span class="n">suma_C</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">suma_BC</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">suma_B</span> <span class="o">-</span> <span class="n">suma_C</span> <span class="o">+</span> <span class="n">suma_BC</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">a_last</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">b_last</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="n">c_last</span><span class="p">:</span>
            <span class="n">suma_A</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)])</span>
            <span class="n">suma_B</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)])</span>
            <span class="n">suma_C</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">suma_AB</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)])</span>
            <span class="n">suma_AC</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">suma_BC</span>  <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">suma_ABC</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">b_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">c_</span><span class="o">*</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b_last</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_last</span><span class="p">)])</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">suma_A</span> <span class="o">-</span> <span class="n">suma_B</span> <span class="o">-</span> <span class="n">suma_C</span> <span class="o">+</span> <span class="n">suma_AB</span> <span class="o">+</span> <span class="n">suma_AC</span> <span class="o">+</span> <span class="n">suma_BC</span> <span class="o">-</span> <span class="n">suma_ABC</span>

    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">prob</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prob</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[334]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_p_CG_from_AQ_SDP</span><span class="p">(</span><span class="n">momentmatrix_solution</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">):</span>
    <span class="n">p_CG_0</span> <span class="o">=</span> <span class="n">momentmatrix_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">settings_per_party</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">nr_parties</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nr_parties</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">correct_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b_</span><span class="p">]</span>
            <span class="n">correct_order</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>
    <span class="k">elif</span> <span class="n">nr_parties</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">correct_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">c_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">z</span><span class="p">][</span><span class="n">c_</span><span class="p">]</span>
            <span class="n">correct_order</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>

    <span class="n">perm</span> <span class="o">=</span> <span class="n">find_permutation</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">correct_order</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">p_CG_permuted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p_CG_0</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_CG_0</span><span class="p">))])</span>
    <span class="n">p_CG</span> <span class="o">=</span> <span class="n">p_CG_permuted</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">correct_order</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_CG</span>

<span class="k">def</span> <span class="nf">p_CG_in_SDP_vector_AQ_SDP</span><span class="p">(</span><span class="n">p_CG_in</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">):</span>
    <span class="n">p_CG_in</span> <span class="o">=</span> <span class="n">p_CG_in</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">settings_per_party</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">nr_parties</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nr_parties</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">correct_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b_</span><span class="p">]</span>
            <span class="n">correct_order</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>
    <span class="k">elif</span> <span class="n">nr_parties</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">correct_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">c_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">prod</span> <span class="o">*=</span> <span class="n">measurements</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">z</span><span class="p">][</span><span class="n">c_</span><span class="p">]</span>
            <span class="n">correct_order</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>

    <span class="n">perm</span> <span class="o">=</span> <span class="n">find_permutation</span><span class="p">(</span> <span class="n">correct_order</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">columns</span><span class="p">)</span>
    <span class="n">p_CG_permuted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p_CG_in</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_CG_in</span><span class="p">))])</span>
    <span class="c1">#p_CG = p_CG_permuted.reshape(correct_order.shape)</span>
    <span class="k">return</span> <span class="n">p_CG_permuted</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[219]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outcomes_per_party</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">settings_per_party</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span><span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                             <span class="n">outcomes_per_party</span><span class="o">=</span><span class="n">outcomes_per_party</span><span class="p">,</span>
                             <span class="n">settings_per_party</span><span class="o">=</span><span class="n">settings_per_party</span><span class="p">,</span>
                             <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span>
                            <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">filename_label</span><span class="o">=</span><span class="n">filename_label</span><span class="p">)</span>
<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>
<span class="n">A0</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">B1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">obj</span> <span class="o">=</span>  <span class="n">A0</span><span class="o">*</span><span class="n">B0</span><span class="o">+</span><span class="n">A0</span><span class="o">*</span><span class="n">B1</span><span class="o">+</span><span class="n">A1</span><span class="o">*</span><span class="n">B0</span><span class="o">-</span><span class="n">A1</span><span class="o">*</span><span class="n">B1</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=+</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;MOSEKFusion&#39;</span><span class="p">,</span> <span class="n">solverparameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;solve_dual&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>  <span class="c1"># By default it maximizes</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum over AQ of CHSH&quot;</span><span class="p">,</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>


<span class="n">Gamma</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">solution_object</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
<span class="n">generating_set</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">generating_monomials</span>
<span class="n">p_CG_0</span> <span class="o">=</span> <span class="n">Gamma</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
<span class="c1">#CG_shape = [3*1+1,3*1+1,2*1+1]</span>
<span class="c1">#p_CG = p_CG.reshape(CG_shape)  # In collins gisin notaton</span>

<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">settings_per_party</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">correct_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">]):</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">prod</span> <span class="o">*=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a_</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">outcomes_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">settings_per_party</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">prod</span> <span class="o">*=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b_</span><span class="p">]</span>
    <span class="n">correct_order</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>

<span class="n">perm</span> <span class="o">=</span> <span class="n">find_permutation</span><span class="p">(</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">generating_monomials_sym</span><span class="p">,</span> <span class="n">correct_order</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">p_CG_permuted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p_CG_0</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_CG_0</span><span class="p">))])</span>
<span class="n">p_CG</span> <span class="o">=</span> <span class="n">p_CG_permuted</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">correct_order</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># p_CG[0,0]</span>
<span class="c1"># p_CG_0, p_CG_permuted, InfSDP.generating_monomials_sym</span>
<span class="n">p_CG</span><span class="p">,</span> <span class="n">correct_order</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix: 100%|██████████| 9/9 [00:00&lt;00:00, 1799.79it/s]
Writing momentmatrix to file : 100%|██████████| 9/9 [00:00&lt;00:00, 8998.51it/s]
Writing monomials to file    : 100%|██████████| 15/15 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 15/15 [00:00&lt;00:00, 14979.66it/s]
Reassigning monomial variables: 100%|██████████| 15/15 [00:00&lt;?, ?it/s]
Reassigning moment matrix indices: 100%|██████████| 9/9 [00:00&lt;00:00, 9007.10it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4*A_1_0_0*B_1_0_0 + 4*A_1_0_0*B_1_1_0 - 4*A_1_0_0 + 4*A_1_1_0*B_1_0_0 - 4*A_1_1_0*B_1_1_0 - 4*B_1_0_0 + 2
minimum over AQ of CHSH 2.0000000484582166
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[219]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([[1.        , 0.45298065, 0.47846019],
        [0.45295239, 0.32969124, 0.33501134],
        [0.47845363, 0.33500597, 0.09377549]]),
 array([[1, B_1_0_0, B_1_1_0],
        [A_1_0_0, A_1_0_0*B_1_0_0, A_1_0_0*B_1_1_0],
        [A_1_1_0, A_1_1_0*B_1_0_0, A_1_1_0*B_1_1_0]], dtype=object))
</pre></div></div>
</div>
</section>
<section id="Now-we-do-the-real-scenario">
<h1>Now we do the real scenario<a class="headerlink" href="#Now-we-do-the-real-scenario" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[220]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quantuminflation.general_tools</span> <span class="kn">import</span> <span class="n">find_permutation</span><span class="p">,</span> <span class="n">apply_substitutions</span>
<span class="kn">from</span> <span class="nn">ncpol2sdpa.nc_utils</span> <span class="kn">import</span> <span class="n">flatten</span>
<span class="kn">import</span> <span class="nn">cvxpy</span> <span class="k">as</span> <span class="nn">cp</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[224]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span> <span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                            <span class="n">outcomes_per_party</span><span class="o">=</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">settings_per_party</span><span class="o">=</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
                            <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>

<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">filename_label</span> <span class="o">=</span> <span class="s1">&#39;AQ&#39;</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span> <span class="p">[[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                            <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">filename_label</span><span class="o">=</span><span class="n">filename_label</span><span class="p">)</span>

<span class="c1"># Going to calculate $W$ &#39;by hand&#39; s.t. I avoid possible problems from using einsum.</span>
<span class="c1"># W = np.zeros(W.shape)</span>
<span class="c1"># for a,b,c,x,y,z in itertools.product(*[range(i) for i in W.shape]):</span>
<span class="c1">#     for alpha, eta in itertools.product(*[range(i) for i in (outs_cardinality_ug[0], ins_cardinality_ug[0])]):</span>
<span class="c1">#         W[a,b,c,x,y,z] += U[alpha,eta,a,b,x,y]*V[alpha,c,eta,z]</span>

<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>

<span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">]):</span>
    <span class="c1">#print(a,b,c,x,y,z)</span>
    <span class="n">Pi_A</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Pi_A</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Pi_B</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Pi_B</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Pi_C</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">z</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Pi_C</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">z</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#Pi_B = meas[1][0][y][b] if b == 0 else sp.S.One - meas[1][0][y][0]</span>
    <span class="c1">#Pi_C = meas[2][0][z][c] if c == 0 else sp.S.One - meas[2][0][z][0]</span>
    <span class="n">obj</span> <span class="o">+=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span><span class="o">*</span><span class="n">Pi_A</span><span class="o">*</span><span class="n">Pi_B</span><span class="o">*</span><span class="n">Pi_C</span><span class="p">)</span>

<span class="n">A0</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">A1</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">A2</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">B0</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">B1</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">B2</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">C0</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">C1</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">use_linear_constraints</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=-</span><span class="n">obj</span><span class="p">)</span>

<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;MOSEKFusion&#39;</span><span class="p">,</span> <span class="n">solverparameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;solve_dual&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>  <span class="c1"># By default it maximizes</span>

<span class="c1">#InfSDP.write_to_file(&#39;inflationMATLAB_&#39;+filename_label+&#39;.mat&#39;)</span>

<span class="nb">print</span><span class="p">(</span><span class="o">-</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>

<span class="n">Gamma</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">solution_object</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
<span class="n">generating_set</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">generating_monomials</span>
<span class="n">p_CG</span> <span class="o">=</span> <span class="n">Gamma</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
<span class="c1">#CG_shape = [3*1+1,3*1+1,2*1+1]</span>
<span class="c1">#p_CG = p_CG.reshape(CG_shape)  # In collins gisin notaton</span>

<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>
<span class="n">correct_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">prod</span> <span class="o">*=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a_</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">b_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">prod</span> <span class="o">*=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b_</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">c_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">prod</span> <span class="o">*=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">z</span><span class="p">][</span><span class="n">c_</span><span class="p">]</span>
    <span class="n">correct_order</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>

<span class="n">perm</span> <span class="o">=</span> <span class="n">find_permutation</span><span class="p">(</span><span class="n">correct_order</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">generating_monomials_sym</span><span class="p">)</span>
<span class="n">p_CG_permuted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p_CG</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_CG</span><span class="p">))])</span>
<span class="n">p_CG</span> <span class="o">=</span> <span class="n">p_CG_permuted</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">correct_order</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">p_CG</span><span class="p">,</span> <span class="n">correct_order</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
InflationProblem with [[1, 1, 1]] as hypergraph, (2, 2, 2) outcomes per party, (3, 3, 2) settings per party and [1] inflation copies per source.
Column structure: 1+A+B+C+AB+AC+BC+ABC
Number of columns: 48
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 48/48 [00:00&lt;00:00, 545.45it/s]
Writing momentmatrix to file : 100%|██████████| 48/48 [00:00&lt;00:00, 2399.97it/s]
Writing monomials to file    : 100%|██████████| 273/273 [00:00&lt;00:00, 273280.43it/s]
Calculating symmetries       : 100%|██████████| 1/1 [00:00&lt;00:00, 17.86it/s]
Applying symmetries          : 100%|██████████| 2/2 [00:00&lt;00:00, 666.66it/s]
Factorizing monomials        : 100%|██████████| 273/273 [00:00&lt;00:00, 10501.05it/s]
Simplifying monomials        : 100%|██████████| 47/47 [00:00&lt;00:00, 330.99it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of known, semi-known and unknown variables = 47 0 226
Number of positive/physical unknown variables = 0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Reassigning monomial variables: 100%|██████████| 273/273 [00:00&lt;00:00, 274130.95it/s]
Reassigning moment matrix indices: 100%|██████████| 48/48 [00:00&lt;00:00, 15997.35it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Problem
  Name                   : InfSDP
  Objective sense        : max
  Type                   : CONIC (conic optimization problem)
  Constraints            : 1178
  Cones                  : 0
  Scalar variables       : 276
  Matrix variables       : 1
  Integer variables      : 0

Optimizer started.
Presolve started.
Linear dependency checker started.
Linear dependency checker terminated.
Eliminator started.
Freed constraints in eliminator : 0
Eliminator terminated.
Eliminator started.
Freed constraints in eliminator : 0
Eliminator terminated.
Eliminator - tries                  : 2                 time                   : 0.00
Lin. dep.  - tries                  : 1                 time                   : 0.02
Lin. dep.  - number                 : 0
Presolve terminated. Time: 0.02
Problem
  Name                   : InfSDP
  Objective sense        : max
  Type                   : CONIC (conic optimization problem)
  Constraints            : 1178
  Cones                  : 0
  Scalar variables       : 276
  Matrix variables       : 1
  Integer variables      : 0

Optimizer  - threads                : 10
Optimizer  - solved problem         : the primal
Optimizer  - Constraints            : 1176
Optimizer  - Cones                  : 1
Optimizer  - Scalar variables       : 274               conic                  : 274
Optimizer  - Semi-definite variables: 1                 scalarized             : 1176
Factor     - setup time             : 0.03              dense det. time        : 0.00
Factor     - ML order time          : 0.01              GP order time          : 0.00
Factor     - nonzeros before factor : 6.93e+05          after factor           : 6.93e+05
Factor     - dense dim.             : 2                 flops                  : 5.49e+08
ITE PFEAS    DFEAS    GFEAS    PRSTATUS   POBJ              DOBJ              MU       TIME
0   1.0e+00  1.2e+00  1.0e+00  0.00e+00   -5.930000000e-01  -5.930000000e-01  1.0e+00  0.05
1   1.2e-01  1.4e-01  8.6e-03  4.71e-01   -4.549301729e-03  7.151137344e-02   1.2e-01  0.09
2   1.8e-02  2.2e-02  1.0e-03  1.90e+00   1.819928149e-02   2.270940132e-02   1.8e-02  0.13
3   3.0e-03  3.7e-03  3.8e-05  1.10e+00   6.067315856e-03   7.197180340e-03   3.0e-03  0.14
4   5.1e-04  6.2e-04  3.4e-06  8.28e-01   4.422639313e-03   4.631585860e-03   5.1e-04  0.17
5   1.9e-04  2.3e-04  9.0e-07  8.45e-01   3.512721202e-03   3.588162622e-03   1.9e-04  0.20
6   5.6e-06  6.8e-06  2.8e-09  9.54e-01   2.847476513e-03   2.850264721e-03   5.6e-06  0.23
7   2.0e-07  2.4e-07  1.2e-11  9.79e-01   2.826028331e-03   2.826134734e-03   2.0e-07  0.27
8   4.5e-08  4.4e-08  1.3e-12  1.01e+00   2.825312375e-03   2.825330146e-03   3.2e-08  0.28
9   2.8e-09  4.5e-09  1.1e-14  1.00e+00   2.825214074e-03   2.825215097e-03   1.8e-09  0.31
Optimizer terminated. Time: 0.33


Interior-point solution summary
  Problem status  : PRIMAL_AND_DUAL_FEASIBLE
  Solution status : OPTIMAL
  Primal.  obj: 2.8252140738e-03    nrm: 1e+00    Viol.  con: 1e-09    var: 0e+00    barvar: 0e+00
  Dual.    obj: 2.8252150974e-03    nrm: 3e+00    Viol.  con: 0e+00    var: 1e-09    barvar: 2e-09
-0.002825214073822524
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[224]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([[[1.        , 0.22684014, 0.09583572],
         [0.0479266 , 0.34813555, 0.34813556],
         [0.33313559, 0.4536352 , 0.50003946],
         [0.15548943, 0.09583573, 0.23391091]],

        [[0.23391089, 0.02622295, 0.06391691],
         [0.04149851, 0.04551215, 0.03627695],
         [0.27947417, 0.17408594, 0.12781529],
         [0.16136222, 0.06391692, 0.14029101]],

        [[0.4536352 , 0.50003944, 0.32268502],
         [0.46780652, 0.22684013, 0.15548943],
         [0.17408593, 0.13646818, 0.12781529],
         [0.16136222, 0.06187293, 0.07255239]],

        [[0.06187293, 0.07255239, 0.02024839],
         [0.04792661, 0.04551215, 0.05915016],
         [0.03094307, 0.03627695, 0.05915016],
         [0.03094306, 0.03354753, 0.04799816]]]),
 array([[[1, C_1_0_0, C_1_1_0],
         [B_1_0_0, B_1_0_0*C_1_0_0, B_1_0_0*C_1_1_0],
         [B_1_1_0, B_1_1_0*C_1_0_0, B_1_1_0*C_1_1_0],
         [B_1_2_0, B_1_2_0*C_1_0_0, B_1_2_0*C_1_1_0]],

        [[A_1_0_0, A_1_0_0*C_1_0_0, A_1_0_0*C_1_1_0],
         [A_1_0_0*B_1_0_0, A_1_0_0*B_1_0_0*C_1_0_0,
          A_1_0_0*B_1_0_0*C_1_1_0],
         [A_1_0_0*B_1_1_0, A_1_0_0*B_1_1_0*C_1_0_0,
          A_1_0_0*B_1_1_0*C_1_1_0],
         [A_1_0_0*B_1_2_0, A_1_0_0*B_1_2_0*C_1_0_0,
          A_1_0_0*B_1_2_0*C_1_1_0]],

        [[A_1_1_0, A_1_1_0*C_1_0_0, A_1_1_0*C_1_1_0],
         [A_1_1_0*B_1_0_0, A_1_1_0*B_1_0_0*C_1_0_0,
          A_1_1_0*B_1_0_0*C_1_1_0],
         [A_1_1_0*B_1_1_0, A_1_1_0*B_1_1_0*C_1_0_0,
          A_1_1_0*B_1_1_0*C_1_1_0],
         [A_1_1_0*B_1_2_0, A_1_1_0*B_1_2_0*C_1_0_0,
          A_1_1_0*B_1_2_0*C_1_1_0]],

        [[A_1_2_0, A_1_2_0*C_1_0_0, A_1_2_0*C_1_1_0],
         [A_1_2_0*B_1_0_0, A_1_2_0*B_1_0_0*C_1_0_0,
          A_1_2_0*B_1_0_0*C_1_1_0],
         [A_1_2_0*B_1_1_0, A_1_2_0*B_1_1_0*C_1_0_0,
          A_1_2_0*B_1_1_0*C_1_1_0],
         [A_1_2_0*B_1_2_0, A_1_2_0*B_1_2_0*C_1_0_0,
          A_1_2_0*B_1_2_0*C_1_1_0]]], dtype=object))
</pre></div></div>
</div>
</section>
<section id="Now-we-can-find-the-U-and-V-above-with-a-seesaw">
<h1>Now we can find the U and V above with a seesaw<a class="headerlink" href="#Now-we-can-find-the-U-and-V-above-with-a-seesaw" title="Permalink to this headline">¶</a></h1>
<p>Get the SDP matrix structure for the AQ set for U and V</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[225]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
</pre></div>
</div>
</div>
<p>First a function that optimizes over AQ probabilities given V and Us.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[324]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outcomes_per_party</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">settings_per_party</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">InfProblem</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span>  <span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">outcomes_per_party</span><span class="o">=</span><span class="n">outcomes_per_party</span><span class="p">,</span>
                                <span class="n">settings_per_party</span><span class="o">=</span><span class="n">settings_per_party</span><span class="p">,</span> <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
<span class="n">InfSDP_3p</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProblem</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">InfSDP_3p</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span> <span class="s1">&#39;local1&#39;</span><span class="p">,</span> <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_numba</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">opt_over_AQ_p</span><span class="p">(</span><span class="n">InfSDP_3p</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;AcEz,AEabxy-&gt;abcxyz&#39;</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
    <span class="n">outcomes_per_party</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">settings_per_party</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
    <span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP_3p</span><span class="o">.</span><span class="n">measurements</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">]):</span>
        <span class="n">Pi_A</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Pi_A</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Pi_B</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Pi_B</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Pi_C</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">z</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Pi_C</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="o">-</span> <span class="n">meas</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">z</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">obj</span> <span class="o">+=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span><span class="o">*</span><span class="n">Pi_A</span><span class="o">*</span><span class="n">Pi_B</span><span class="o">*</span><span class="n">Pi_C</span><span class="p">)</span>

    <span class="n">InfSDP_3p</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=-</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># By default it maximizes</span>
    <span class="n">InfSDP_3p</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;MOSEKFusion&#39;</span><span class="p">,</span> <span class="n">solverparameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;solve_dual&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
    <span class="n">p_CG</span> <span class="o">=</span> <span class="n">extract_p_CG_from_AQ_SDP</span><span class="p">(</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">solution_object</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span> <span class="n">meas</span><span class="p">,</span> <span class="n">InfSDP_3p</span><span class="o">.</span><span class="n">generating_monomials_sym</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">)</span>
    <span class="c1">#print(-InfSDP.primal_objective)</span>
    <span class="k">return</span> <span class="n">p_CG</span><span class="p">,</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">solution_object</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:],</span> <span class="o">-</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span>

<span class="n">p_CG</span><span class="p">,</span> <span class="n">p_CG_raw</span><span class="p">,</span> <span class="n">optval</span> <span class="o">=</span> <span class="n">opt_over_AQ_p</span><span class="p">(</span><span class="n">InfSDP_3p</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
<span class="c1">#p_CG, optval</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">CG_to_prob_3party</span><span class="p">(</span><span class="n">p_CG</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 48/48 [00:00&lt;00:00, 578.33it/s]
Writing momentmatrix to file : 100%|██████████| 48/48 [00:00&lt;00:00, 2285.57it/s]
Writing monomials to file    : 100%|██████████| 273/273 [00:00&lt;00:00, 273737.75it/s]
Factorizing monomials        : 100%|██████████| 273/273 [00:00&lt;00:00, 10112.38it/s]
Reassigning monomial variables: 100%|██████████| 273/273 [00:00&lt;00:00, 273150.05it/s]
Reassigning moment matrix indices: 100%|██████████| 48/48 [00:00&lt;00:00, 48175.78it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[339]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outcomes_per_party</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">settings_per_party</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">InfSDP_V</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InflationProblem</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="o">=</span><span class="n">outcomes_per_party</span><span class="p">,</span><span class="n">settings_per_party</span><span class="o">=</span><span class="n">settings_per_party</span><span class="p">))</span>
<span class="n">InfSDP_V</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span><span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span><span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">known_vars</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">positionsmatrix</span> <span class="o">=</span> <span class="n">InfSDP_V</span><span class="o">.</span><span class="n">momentmatrix</span>

<span class="c1"># objective = {key: float(val) for key, val in objective.items()}</span>

<span class="n">nr_variables</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">nr_known</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">known_vars</span><span class="p">)</span>
<span class="n">nr_unknown</span> <span class="o">=</span> <span class="n">nr_variables</span> <span class="o">-</span> <span class="n">nr_known</span>

<span class="n">Iden</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#cp.diag(np.ones(positionsmatrix.shape[0]))</span>
<span class="n">F0</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">lil_matrix</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_known</span><span class="p">):</span>
    <span class="n">F0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">positionsmatrix</span> <span class="o">==</span> <span class="n">variable</span><span class="p">)]</span> <span class="o">=</span> <span class="n">known_vars</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
<span class="n">F_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_known</span><span class="p">,</span> <span class="n">nr_variables</span><span class="p">):</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">lil_matrix</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">positionsmatrix</span> <span class="o">==</span> <span class="n">var</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">F_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>

<span class="c1">#def opt_over_AQ_V(InfSDP_2p_V, U, p):</span>
<span class="n">omega_alpha_c_eta_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;AEabxy,abcxyz-&gt;AcEz&#39;</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">omega_alpha_c_eta_z_CG</span> <span class="o">=</span> <span class="n">prob_to_CG_2parties</span><span class="p">(</span><span class="n">omega_alpha_c_eta_z</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">)</span>
<span class="n">omega_alpha_c_eta_z_CG_raw</span> <span class="o">=</span> <span class="n">p_CG_in_SDP_vector_AQ_SDP</span><span class="p">(</span><span class="n">omega_alpha_c_eta_z_CG</span><span class="p">,</span> <span class="n">InfSDP_V</span><span class="o">.</span><span class="n">measurements</span><span class="p">,</span> <span class="n">InfSDP_V</span><span class="o">.</span><span class="n">generating_monomials_sym</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">)</span>

<span class="c1"># meas = InfSDP_V.measurements</span>
<span class="c1"># obj = 0</span>
<span class="c1"># Vshape = [*outcomes_per_party, *settings_per_party]</span>
<span class="c1"># for alpha,c,eta,z in itertools.product(*[range(i) for i in Vshape]):</span>
<span class="c1">#     Pi_A = 1-sum([meas[0][0][eta][o_] for o_ in range(Vshape[0]-1)]) if alpha==(Vshape[0]-1) else meas[0][0][eta][alpha]</span>
<span class="c1">#     Pi_C = 1-sum([meas[1][0][z  ][o_] for o_ in range(Vshape[1]-1)]) if c==(Vshape[1]-1) else meas[1][0][z][c]</span>
<span class="c1">#     obj += sp.expand(omega_alpha_c_eta_z[alpha,c,eta,z]*Pi_A*Pi_C)</span>
<span class="c1"># obj = sp.expand(obj)</span>
<span class="c1"># InfSDP_V.set_objective(objective=obj)</span>
<span class="c1"># objective = InfSDP_V._objective_as_dict</span>
<span class="c1"># objective</span>

<span class="n">Z</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">PSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">PSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dim</span> <span class="o">=</span> <span class="n">omega_alpha_c_eta_z_CG</span><span class="o">.</span><span class="n">size</span>
<span class="n">v_i</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>

<span class="n">Fi_observable</span>   <span class="o">=</span> <span class="n">F_list</span><span class="p">[:</span><span class="n">dim</span><span class="p">]</span>
<span class="n">Fi_unobservable</span> <span class="o">=</span> <span class="n">F_list</span><span class="p">[</span><span class="n">dim</span><span class="p">:]</span>

<span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span> <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">F0</span> <span class="o">@</span> <span class="n">Z</span><span class="p">)</span> <span class="o">==</span> <span class="n">v_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Z</span><span class="p">)</span> <span class="o">==</span> <span class="n">v_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Fi_observable</span><span class="p">)],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Z</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>       <span class="k">for</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="n">Fi_unobservable</span><span class="p">],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">F0</span> <span class="o">@</span> <span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">-</span><span class="n">v_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="n">v_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Fi_observable</span><span class="p">)],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>       <span class="k">for</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="n">Fi_unobservable</span><span class="p">]]</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">v_i</span> <span class="o">@</span> <span class="n">omega_alpha_c_eta_z_CG_raw</span>

<span class="n">prob</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">constraints</span><span class="p">)</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">MOSEK</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">v_i</span><span class="o">.</span><span class="n">value</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 9/9 [00:00&lt;00:00, 3003.80it/s]
Writing momentmatrix to file : 100%|██████████| 9/9 [00:00&lt;00:00, 9002.80it/s]
Writing monomials to file    : 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 16/16 [00:00&lt;00:00, 8003.44it/s]
Reassigning monomial variables: 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Reassigning moment matrix indices: 100%|██████████| 9/9 [00:00&lt;00:00, 8992.08it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[339]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(-0.36356411516951304,
 array([ 4.99999983e-01, -4.69313604e-01, -5.65745067e-02,  1.74348033e-07,
        -9.31854695e-01, -1.65205475e-07,  1.02588763e+00, -8.62558911e-08,
        -5.16828804e-01]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[356]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_if_valid_AQ_effect</span><span class="p">(</span><span class="n">effect_in_CG_raw</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">):</span>
    <span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InflationProblem</span><span class="p">(</span><span class="n">outcomes_per_party</span><span class="o">=</span><span class="n">outcomes_per_party</span><span class="p">,</span><span class="n">settings_per_party</span><span class="o">=</span><span class="n">settings_per_party</span><span class="p">))</span>
    <span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span><span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span><span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">generating_monomials_sym</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">effect_in_CG_raw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">generating_monomials_sym</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">effect_in_CG_raw</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
    <span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">()</span>
    <span class="c1">#InfSDP._objective_as_dict = {**{0:0, 1:1,},**{var+1:-val for var, val in enumerate(effect_in_CG_raw)}}</span>
    <span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;CVXPY&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">InfSDP</span><span class="o">.</span><span class="n">_objective_as_dict</span><span class="p">)</span>

<span class="n">check_if_valid_AQ_effect</span><span class="p">(</span><span class="n">v_i</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">outcomes_per_party</span><span class="p">,</span> <span class="n">settings_per_party</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 9/9 [00:00&lt;00:00, 3005.23it/s]
Writing momentmatrix to file : 100%|██████████| 9/9 [00:00&lt;00:00, 9009.24it/s]
Writing monomials to file    : 100%|██████████| 16/16 [00:00&lt;00:00, 15963.10it/s]
Factorizing monomials        : 100%|██████████| 16/16 [00:00&lt;00:00, 15982.11it/s]
Reassigning monomial variables: 100%|██████████| 16/16 [00:00&lt;00:00, 16039.40it/s]
Reassigning moment matrix indices: 100%|██████████| 9/9 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1, A_1_0_0, A_1_1_0, B_1_0_0, B_1_1_0, A_1_0_0*B_1_0_0, A_1_0_0*B_1_1_0, A_1_1_0*B_1_0_0, A_1_1_0*B_1_1_0]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">~\AppData\Local\Temp/ipykernel_56468/3584160172.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">     10</span>     print<span class="ansi-yellow-intense-fg ansi-bold">(</span>InfSDP<span class="ansi-yellow-intense-fg ansi-bold">.</span>_objective_as_dict<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     11</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 12</span><span class="ansi-yellow-intense-fg ansi-bold"> </span>check_if_valid_AQ_effect<span class="ansi-yellow-intense-fg ansi-bold">(</span>v_i<span class="ansi-yellow-intense-fg ansi-bold">.</span>value<span class="ansi-yellow-intense-fg ansi-bold">,</span> outcomes_per_party<span class="ansi-yellow-intense-fg ansi-bold">,</span> settings_per_party<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">~\AppData\Local\Temp/ipykernel_56468/3584160172.py</span> in <span class="ansi-cyan-fg">check_if_valid_AQ_effect</span><span class="ansi-blue-intense-fg ansi-bold">(effect_in_CG_raw, outcomes_per_party, settings_per_party)</span>
<span class="ansi-green-fg">      4</span>     print<span class="ansi-yellow-intense-fg ansi-bold">(</span>InfSDP<span class="ansi-yellow-intense-fg ansi-bold">.</span>generating_monomials_sym<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      5</span>     obj <span class="ansi-yellow-intense-fg ansi-bold">=</span> sum<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">[</span>effect_in_CG_raw<span class="ansi-yellow-intense-fg ansi-bold">[</span>i<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">*</span>InfSDP<span class="ansi-yellow-intense-fg ansi-bold">.</span>generating_monomials_sym<span class="ansi-yellow-intense-fg ansi-bold">[</span>i<span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-green-intense-fg ansi-bold">for</span> i <span class="ansi-green-intense-fg ansi-bold">in</span> range<span class="ansi-yellow-intense-fg ansi-bold">(</span>effect_in_CG_raw<span class="ansi-yellow-intense-fg ansi-bold">.</span>size<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 6</span><span class="ansi-yellow-intense-fg ansi-bold">     </span>InfSDP<span class="ansi-yellow-intense-fg ansi-bold">.</span>set_objective<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      7</span>     <span class="ansi-red-intense-fg ansi-bold">#InfSDP._objective_as_dict = {**{0:0, 1:1,},**{var+1:-val for var, val in enumerate(effect_in_CG_raw)}}</span>
<span class="ansi-green-fg">      8</span>     InfSDP<span class="ansi-yellow-intense-fg ansi-bold">.</span>solve<span class="ansi-yellow-intense-fg ansi-bold">(</span>interpreter<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;CVXPY&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-intense-fg ansi-bold">TypeError</span>: set_objective() missing 1 required positional argument: &#39;objective&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><br/><br/><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">PSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">positionsmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">PSD</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dim</span> <span class="o">=</span> <span class="n">omega_alpha_c_eta_z_CG</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">v_i</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
<span class="n">v_0</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Fi_observable</span>   <span class="o">=</span> <span class="n">F_list</span><span class="p">[:</span><span class="n">dim</span><span class="p">]</span>
<span class="n">Fi_unobservable</span> <span class="o">=</span> <span class="n">F_list</span><span class="p">[</span><span class="n">dim</span><span class="p">:]</span>

<span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span> <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">F0</span> <span class="o">@</span> <span class="n">Z</span><span class="p">)</span> <span class="o">==</span> <span class="n">v_0</span><span class="p">],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Z</span><span class="p">)</span> <span class="o">==</span> <span class="n">v_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Fi_observable</span><span class="p">)],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Z</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>       <span class="k">for</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="n">Fi_unobservable</span><span class="p">],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">F0</span> <span class="o">@</span> <span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">-</span><span class="n">v_0</span><span class="p">],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="n">v_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Fi_observable</span><span class="p">)],</span>
                <span class="o">*</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Fi</span> <span class="o">@</span> <span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>    <span class="k">for</span> <span class="n">Fi</span> <span class="ow">in</span> <span class="n">Fi_unobservable</span><span class="p">]]</span><span class="n">obj</span> <span class="o">=</span> <span class="n">p_CG_CHSH</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">v_0</span> <span class="o">+</span> <span class="n">cp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p_CG_CHSH</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">@</span> <span class="n">v_i</span><span class="p">)</span>
<span class="n">p_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">])</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">p_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">v_0</span> <span class="o">+</span> <span class="n">cp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">@</span> <span class="n">v_i</span><span class="p">)</span>


<span class="n">prob</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span>
                  <span class="n">constraints</span><span class="p">)</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">MOSEK</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="n">v_0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">v_i</span><span class="o">.</span><span class="n">value</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_0</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">v_i</span><span class="o">.</span><span class="n">value</span><span class="p">[:]</span>
<span class="n">v</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[201]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 9/9 [00:00&lt;00:00, 3000.22it/s]
Writing momentmatrix to file : 100%|██████████| 9/9 [00:00&lt;00:00, 8996.36it/s]
Writing monomials to file    : 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 16/16 [00:00&lt;00:00, 16001.16it/s]
Reassigning monomial variables: 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Reassigning moment matrix indices: 100%|██████████| 9/9 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">~\AppData\Local\Temp/ipykernel_56468/1920311052.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      5</span>
<span class="ansi-green-fg">      6</span> <span class="ansi-red-intense-fg ansi-bold">#def opt_over_AQ_V(InfSDP_2p_V, U, p):</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 7</span><span class="ansi-yellow-intense-fg ansi-bold"> </span>omega_alpha_c_eta_z <span class="ansi-yellow-intense-fg ansi-bold">=</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>einsum<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;AEabxy,abcxyz-&gt;AcEz&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> U<span class="ansi-yellow-intense-fg ansi-bold">,</span> p<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      8</span> omega_alpha_c_eta_z_CG <span class="ansi-yellow-intense-fg ansi-bold">=</span> prob_to_CG_2parties<span class="ansi-yellow-intense-fg ansi-bold">(</span>omega_alpha_c_eta_z<span class="ansi-yellow-intense-fg ansi-bold">,</span> outcomes_per_party<span class="ansi-yellow-intense-fg ansi-bold">,</span> settings_per_party<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-intense-fg ansi-bold">NameError</span>: name &#39;p&#39; is not defined
</pre></div></div>
</div>
<p>Get the omega_alpha_c_eta_z from CHSH. Get the AQ correlations that maximize CHSH.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># InfProb = InflationProblem(hypergraph=[[1, 1]], outcomes_per_party=[2,2], settings_per_party=[2,2], inflation_level_per_source=[1],names=[&#39;A&#39;, &#39;B&#39;])</span>
<span class="c1"># InfSDP = InflationSDP(InfProb, commuting=False, verbose=0)</span>
<span class="c1"># InfSDP.generate_relaxation( column_specification=&#39;local1&#39;,</span>
<span class="c1">#                             max_monomial_length=False,</span>
<span class="c1">#                             find_physical_monomials=False,</span>
<span class="c1">#                             use_linear_constraints=False,</span>
<span class="c1">#                             sandwich_positivity=False,</span>
<span class="c1">#                             load_from_file=False,</span>
<span class="c1">#                             filename_label=filename_label)</span>
<span class="c1"># meas = InfSDP.measurements</span>
<span class="c1"># A0, A1, B0, B1 = 1-2*meas[0][0][0][0], 1-2*meas[0][0][1][0], 1-2*meas[1][0][0][0], 1-2*meas[1][0][1][0]</span>
<span class="c1"># obj =  A0*B0+A0*B1+A1*B0-A1*B1</span>
<span class="c1"># obj = sp.expand(obj)</span>
<span class="c1"># print(obj)</span>
<span class="c1"># InfSDP.set_objective(objective=+obj)</span>
<span class="c1"># InfSDP.solve(interpreter=&#39;CVXPY&#39;)  # By default it maximizes</span>
<span class="c1"># print(&quot;minimum over AQ of CHSH&quot;, InfSDP.primal_objective)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 9/9 [00:00&lt;00:00, 4500.86it/s]
Writing momentmatrix to file : 100%|██████████| 9/9 [00:00&lt;00:00, 8972.84it/s]
Writing monomials to file    : 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 16/16 [00:00&lt;00:00, 16024.08it/s]
Reassigning monomial variables: 100%|██████████| 16/16 [00:00&lt;?, ?it/s]
Reassigning moment matrix indices: 100%|██████████| 9/9 [00:00&lt;00:00, 9002.80it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2 - 4*A_1_0_0 + 4*A_1_0_0*B_1_0_0 + 4*A_1_0_0*B_1_1_0 + 4*A_1_1_0*B_1_0_0 - 4*A_1_1_0*B_1_1_0 - 4*B_1_0_0
minimum over AQ of CHSH 2.8284271790023405
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span><span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">outcomes_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">settings_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span>
                            <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">filename_label</span><span class="o">=</span><span class="n">filename_label</span><span class="p">)</span>
<span class="c1">#meas = InfSDP.measurements</span>
<span class="n">obj</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">prob</span><span class="o">*</span><span class="n">sym</span> <span class="k">for</span> <span class="n">prob</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p_vec</span><span class="p">,</span> <span class="n">generating_set_CHSH</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=-</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;CVXPY&#39;</span><span class="p">)</span>  <span class="c1"># By default it maximizes</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum over AQ of CHSH&quot;</span><span class="p">,</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def optimize_UorVorp(flag, V, U, p, InflationSDP):</span>
<span class="c1">#     if flag == 0: # V and p are fixed, then this is a linear problem</span>

<span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># U and p are fixed, this is then a linear program</span>
    <span class="o">...</span>
<span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># V and p are fixed, this is then a linear program</span>
    <span class="n">Unum</span> <span class="o">=</span> <span class="n">U</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">Unum</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">Uvars</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">U_multidim</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">idxs_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">])):</span>
        <span class="c1"># idxs_ is (alpha,eta,a,b,x,y)</span>
        <span class="n">U_multidim</span><span class="p">[</span><span class="n">idxs_</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uvars</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># cvxpy doesnt allow indexing of multi-dimensional variables</span>

    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span> <span class="n">U</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">alpha</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">4</span><span class="p">:]]]):</span>
        <span class="n">summ</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]]):</span>
            <span class="n">summ</span> <span class="o">+=</span> <span class="n">U_multidim</span><span class="p">[(</span><span class="n">alpha</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)]</span>
        <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">summ</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">]</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">alpha</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">)[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]):</span>
            <span class="n">obj</span> <span class="o">+=</span> <span class="n">V</span><span class="p">[(</span><span class="n">alpha</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">z</span><span class="p">)]</span><span class="o">*</span><span class="n">U_multidim</span><span class="p">[(</span><span class="n">alpha</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)]</span><span class="o">*</span><span class="n">p</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)]</span>
<span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># V and U are fixed, then this is an SDP</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</section>
<section id="With-extra-output">
<h1>With extra output<a class="headerlink" href="#With-extra-output" title="Permalink to this headline">¶</a></h1>
<p>Now we do <span class="math notranslate nohighlight">\(V_2\)</span> such that the extra output has zero support</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># V2 = np.zeros((3,2,2,2))</span>
<span class="c1"># V2[:-1,:,:,:] = V</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InfProb</span> <span class="o">=</span> <span class="n">InflationProblem</span><span class="p">(</span> <span class="n">hypergraph</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                            <span class="n">outcomes_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                            <span class="n">settings_per_party</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                            <span class="n">inflation_level_per_source</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">InfSDP</span> <span class="o">=</span> <span class="n">InflationSDP</span><span class="p">(</span><span class="n">InfProb</span><span class="p">,</span> <span class="n">commuting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">filename_label</span> <span class="o">=</span> <span class="s1">&#39;AQ_U&#39;</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">generate_relaxation</span><span class="p">(</span> <span class="n">column_specification</span><span class="o">=</span><span class="s1">&#39;local1&#39;</span><span class="p">,</span>
                            <span class="n">max_monomial_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">find_physical_monomials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">use_linear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">sandwich_positivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">load_from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">filename_label</span><span class="o">=</span><span class="n">filename_label</span><span class="p">)</span>
<span class="n">meas</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">measurements</span>
<span class="c1"># for eta, alpha in itertools.product(range(2), repeat=2):</span>
<span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#for a,b,x,y in itertools.product(*[range(i) for i in V2.shape]):</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">]):</span>
    <span class="c1">#print(a,b,x,y)</span>
    <span class="n">Pi_A</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="n">meas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="n">a</span><span class="p">]</span>
    <span class="n">Pi_B</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">b</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">meas</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="n">b</span><span class="p">]</span>
    <span class="c1">#obj += V2[a,b,x,y]*Pi_A*Pi_B</span>
    <span class="n">obj</span> <span class="o">+=</span> <span class="n">V</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span><span class="o">*</span><span class="n">Pi_A</span><span class="o">*</span><span class="n">Pi_B</span>
<span class="c1"># if (alpha, eta) == (0, 1):</span>
<span class="c1">#     obj -= 0.8</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;V2=&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=-</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;MOSEKFusion&#39;</span><span class="p">)</span>  <span class="c1"># By default it maximizes</span>
<span class="n">minimo</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum over AQ of V2&quot;</span><span class="p">,</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">InfSDP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="s1">&#39;MOSEKFusion&#39;</span><span class="p">)</span>  <span class="c1"># By default it maximizes</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximum over AQ of V2&quot;</span><span class="p">,</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span><span class="p">)</span>
<span class="n">maximo</span> <span class="o">=</span> <span class="n">InfSDP</span><span class="o">.</span><span class="n">primal_objective</span>
<span class="c1"># Add the minimum and divide by the difference between the maximum and minimum</span>

<span class="c1"># print(&quot;Renormalize&quot;)</span>
<span class="c1"># V2[:,:,0,0] += minimo</span>
<span class="c1"># V2[:,:,:,:] /= maximo - minimo</span>

<span class="c1"># obj = 0</span>
<span class="c1"># for a,b,x,y in itertools.product(*[range(i) for i in V2.shape]):</span>
<span class="c1">#     #print(a,b,x,y)</span>
<span class="c1">#     Pi_A = 1-(meas[0][0][x][0]+meas[0][0][x][1]) if a==2 else meas[0][0][x][a]</span>
<span class="c1">#     Pi_B = 1-(meas[1][0][y][0]) if b==1 else meas[1][0][y][b]</span>
<span class="c1">#     obj += V2[a,b,x,y]*Pi_A*Pi_B</span>
<span class="c1"># obj = sp.expand(obj)</span>
<span class="c1"># print(&quot;V2 =&quot;, obj)</span>
<span class="c1"># InfSDP.set_objective(objective=-obj)</span>
<span class="c1"># InfSDP.solve()  # By default it maximizes</span>
<span class="c1"># minimo = InfSDP.primal_objective</span>
<span class="c1"># print(&quot;minimum over AQ of V2&quot;, -InfSDP.primal_objective)</span>
<span class="c1"># InfSDP.set_objective(objective=obj)</span>
<span class="c1"># InfSDP.solve()  # By default it maximizes</span>
<span class="c1"># print(&quot;Maximum over AQ of V2&quot;, InfSDP.primal_objective)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating moment matrix    : 100%|██████████| 15/15 [00:00&lt;00:00, 2499.39it/s]
Writing momentmatrix to file : 100%|██████████| 15/15 [00:00&lt;00:00, 7505.91it/s]
Writing monomials to file    : 100%|██████████| 39/39 [00:00&lt;?, ?it/s]
Factorizing monomials        : 100%|██████████| 39/39 [00:00&lt;00:00, 9750.71it/s]
Reassigning monomial variables: 100%|██████████| 39/39 [00:00&lt;?, ?it/s]
Reassigning moment matrix indices: 100%|██████████| 15/15 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
V2= 0.00459999999999999*A_1_0_0 + 0.224*A_1_0_0*B_1_0_0 + 0.5578*A_1_0_0*B_1_1_0 + 0.159*A_1_0_1 + 0.8372*A_1_0_1*B_1_0_0 + 0.0031*A_1_0_1*B_1_1_0 + 0.5884*A_1_1_0 - 0.5902*A_1_1_0*B_1_0_0 - 0.7404*A_1_1_0*B_1_1_0
minimum over AQ of V2 0.7422000004622425
Maximum over AQ of V2 0.9999673697516185
</pre></div></div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">inflation</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mee.html">All about me</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">inflation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Check-CHSH-with-the-SDP">Check CHSH with the SDP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Functions-for-Collins-Gisin-notation">Functions for Collins Gisin notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Now-we-do-the-real-scenario">Now we do the real scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Now-we-can-find-the-U-and-V-above-with-a-seesaw">Now we can find the U and V above with a seesaw</a></li>
<li class="toctree-l1"><a class="reference internal" href="#With-extra-output">With extra output</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quantuminflation.html" title="previous chapter">quantuminflation package</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Emanuel-Cristian Boghiu, Alejandro Pozas-Kerstjens.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/almostq.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>